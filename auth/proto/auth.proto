syntax = "proto3";

package auth;

option go_package = "github.com/iautre/gowk/auth/proto;auth";

import "google/protobuf/empty.proto";

service AuthService {
  rpc OAuth2Token(OAuth2TokenRequest) returns (OAuth2TokenResponse);
  rpc OIDCUserInfo(OIDCUserInfoRequest) returns (OIDCUserInfoResponse);
  rpc OIDCJwks(google.protobuf.Empty) returns (OIDCJwksResponse);
  rpc OIDCDiscovery(google.protobuf.Empty) returns (OIDCDiscoveryResponse);
}

message OAuth2TokenRequest {
  string grant_type = 1;
  string code = 2;
  string redirect_uri = 3;
  string client_id = 4;
  string client_secret = 5;
  string refresh_token = 6;
  string scope = 7;
  string code_verifier = 8; // PKCE support
}

message OAuth2TokenResponse {
  string access_token = 1;
  string token_type = 2;
  int64 expires_in = 3;
  string refresh_token = 4;
  string scope = 5;
  string id_token = 6;
}

message OIDCUserInfoRequest {
  string access_token = 1;
}

message OIDCUserInfoResponse {
  string sub = 1;
  string name = 2;
  string email = 3;
  bool email_verified = 4;
  string given_name = 5;
  string family_name = 6;
  string middle_name = 7;
  string nickname = 8;
  string preferred_username = 9;
  string picture = 10;
  string phone_number = 11;
  bool phone_number_verified = 12;
  string locale = 13;
  int64 updated_at = 14;
}

message OIDCJwksResponse {
  repeated OIDCJwk keys = 1;
}

message OIDCJwk {
  string kty = 1;
  string use = 2;
  string kid = 3;
  string n = 4;
  string e = 5;
  string alg = 6;
}

message OIDCDiscoveryResponse {
  string issuer = 1;
  string authorization_endpoint = 2;
  string token_endpoint = 3;
  string userinfo_endpoint = 4;
  string jwks_uri = 5;
  repeated string scopes_supported = 6;
  repeated string response_types_supported = 7;
  repeated string grant_types_supported = 8;
  repeated string subject_types_supported = 9;
  repeated string id_token_signing_alg_values_supported = 10;
}
